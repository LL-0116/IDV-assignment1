import matplotlib.pyplot as plt
import numpy as np
from datetime import datetime
import time

# 1. 初始化图表（设置美观样式）
plt.rcParams['font.sans-serif'] = ['SimHei', 'Arial Unicode MS']  # 解决中文显示
plt.rcParams['axes.unicode_minus'] = False  # 解决负号显示
fig, ax = plt.subplots(figsize=(10, 6), facecolor='#f8f9fa')  # 浅色背景更清爽

# 2. 模拟实时数据（可替换为你的真实数据来源，如接口、数据库）
x_data = []
y_data = []
update_interval = 1  # 数据更新间隔（秒）

def update_data():
    """实时更新数据的核心函数"""
    x_data.append(len(x_data) + 1)  # 模拟x轴递增（如时间戳、序号）
    y_data.append(np.random.randint(10, 50))  # 模拟随机波动的y轴数据（替换为你的数据逻辑）

def update_title_with_date():
    """标题+右下角日期（通过text控件实现）"""
    main_title = "实时数据监控图表"  # 你的主标题
    current_date = datetime.now().strftime("%Y-%m-%d %H:%M:%S")  # 实时日期时间
    ax.set_title(main_title, fontsize=16, fontweight='bold', pad=20)  # 主标题样式
    # 日期放在标题右下角：x=0.98（右对齐），y=0.95（标题区域内），transform绑定axes坐标
    ax.text(0.98, 0.95, current_date, transform=ax.transAxes, 
            fontsize=10, color='#666', ha='right', va='top')

# 3. 实时刷新逻辑
plt.ion()  # 开启交互模式（关键：实现实时更新不阻塞）
try:
    while True:
        update_data()  # 更新数据
        ax.clear()     # 清空上一帧内容
        # 绘制图表（可替换为你的图表类型，如折线图、柱状图）
        ax.plot(x_data, y_data, color='#2E86AB', linewidth=2.5, marker='o', markersize=4)
        # 设置坐标轴样式
        ax.set_xlabel('数据序号', fontsize=12, labelpad=10)
        ax.set_ylabel('实时数值', fontsize=12, labelpad=10)
        ax.grid(True, alpha=0.3, linestyle='--')  # 浅灰色网格线，更清晰
        ax.set_facecolor('#ffffff')  # 子图背景色
        
        update_title_with_date()  # 更新标题和右下角日期
        plt.tight_layout()  # 自动调整布局，避免元素重叠
        plt.draw()          # 绘制当前帧
        plt.pause(update_interval)  # 暂停指定时间，控制更新频率
except KeyboardInterrupt:
    print("实时监控已停止")
finally:
    plt.ioff()  # 关闭交互模式
    plt.show()   # 保持最后一帧显示
